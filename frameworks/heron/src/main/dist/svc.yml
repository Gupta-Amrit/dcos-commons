name: {{FRAMEWORK_NAME}}
scheduler:
  principal: {{FRAMEWORK_PRINCIPAL}}
  user: {{FRAMEWORK_USER}}
pods:
  api:
    count: {{NODE_COUNT}}
    image: {{HERON_IMAGE}}
    placement: '{{{NODE_PLACEMENT}}}'
    uris:
      - {{BOOTSTRAP_URI}}
      - {{EXECUTOR_URI}}
      - {{HERON_INSTALLER_URI}}
      - {{BAZEL_INSTALLER_URI}}
    volume:
      path: api-container-path
      type: {{NODE_DISK_TYPE}}
      size: {{NODE_DISK}}
    tasks:
      server:
        goal: RUNNING
        cpus: {{NODE_CPUS}}
        memory: {{NODE_MEM}}
        ports:
          server:
            port: 9000
        cmd: |
          set -e
          env
          echo $(pwd)
          echo "This is a test for the api server"
          java -version
          python --version

          chmod +x bazel-*.sh
          ./bazel-*.sh --user
          bazel version

          chmod +x heron-*.sh
          ./heron-*.sh --user
          heron version

          heron-apiserver \
          --base-template mesos \
          --cluster sandbox
  tracker:
    count: {{NODE_COUNT}}
    image: {{HERON_IMAGE}}
    placement: '{{{NODE_PLACEMENT}}}'
    uris:
      - {{BOOTSTRAP_URI}}
      - {{EXECUTOR_URI}}
      - {{HERON_INSTALLER_URI}}
      - {{BAZEL_INSTALLER_URI}}
    volume:
      path: tracker-container-path
      type: {{NODE_DISK_TYPE}}
      size: {{NODE_DISK}}
    tasks:
      server:
        goal: RUNNING
        cpus: {{NODE_CPUS}}
        memory: {{NODE_MEM}}
        ports:
          rest:
            port: 8888
        cmd: |
          set -e
          env
          echo $(pwd)
          echo "This is a test for the tracker"
          java -version
          python --version

          export JAVA_HOME=$(ls -d /usr/lib/jvm/java-8-openjdk-amd64)

          chmod +x bazel-*.sh
          ./bazel-*.sh --user
          bazel version

          chmod +x heron-*.sh
          ./heron-*.sh --user
          heron version

          heron-tracker
  ui:
    count: {{NODE_COUNT}}
    image: {{HERON_IMAGE}}
    placement: '{{{NODE_PLACEMENT}}}'
    uris:
      - {{BOOTSTRAP_URI}}
      - {{EXECUTOR_URI}}
      - {{HERON_INSTALLER_URI}}
      - {{BAZEL_INSTALLER_URI}}
    volume:
      path: ui-container-path
      type: {{NODE_DISK_TYPE}}
      size: {{NODE_DISK}}
    tasks:
      server:
        goal: RUNNING
        cpus: {{NODE_CPUS}}
        memory: {{NODE_MEM}}
        ports:
          http:
            port: 8889
        cmd: |
          set -e
          env
          echo $(pwd)
          echo "This is a test for the ui"
          java -version
          python --version

          export JAVA_HOME=$(ls -d /usr/lib/jvm/java-8-openjdk-amd64)

          chmod +x bazel-*.sh
          ./bazel-*.sh --user
          bazel version

          chmod +x heron-*.sh
          ./heron-*.sh --user
          heron version

          heron-ui